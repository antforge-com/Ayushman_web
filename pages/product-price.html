<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#234123">
  <meta name="description" content="Ayurvedic product price calculation app">
  <title>Product Price Calculator</title>

  <!-- Tailwind CSS for modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* Custom styles for this page */
    :root {
      --bg: #ffffff;
      --surface: #ffffff;
      --primary: #234123;
      --primary-600: #1d361d;
      --accent: #7cc58f;
      --text: #1f2937;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
      --radius: 14px;
    }

    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .topbar {
      position: fixed;
      inset: 0 0 auto 0;
      height: 64px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 0 14px;
      z-index: 200;
    }

    .left-logo-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .left-logo-wrap img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--border);
    }

    .hamburger-btn {
      width: 42px;
      height: 42px;
      border: none;
      background: transparent;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .hamburger {
      width: 24px;
      height: 2px;
      background: var(--primary);
      position: relative;
      display: block;
    }

    .hamburger::before,
    .hamburger::after {
      content: "";
      position: absolute;
      left: 0;
      width: 24px;
      height: 2px;
      background: var(--primary);
      transition: transform 0.2s ease, top 0.2s ease, opacity 0.2s ease;
    }

    .hamburger::before {
      top: -7px;
    }

    .hamburger::after {
      top: 7px;
    }

    .topbar-logo {
      height: 84px;
      width: auto;
    }

    .drawer {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 260px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      transform: translateX(-100%);
      transition: transform .25s ease;
      z-index: 300;
      padding: 78px 0 12px;
  display: flex;
  flex-direction: column;
  height: 100vh;
  min-height: 100vh;
  padding: 78px 0 0;
    }

    .drawer.open {
      transform: translateX(0);
    }

    .drawer-logo {
      text-align: center;
      padding: 0 16px 12px 16px;
    }

    .drawer-logo img {
      max-height: 80px;
      height: auto;
      margin: 0 auto 8px;
    }

    .drawer-link {
      padding: 12px 18px;
      font-size: 1rem;
      color: var(--primary);
      font-weight: 600;
      border-left: 4px solid transparent;
    }

    .drawer-link:hover {
      background: #f0f0f0;
    }

    .drawer-link.active {
      background: #f0f0f0;
      border-left-color: var(--primary);
    }

    .logout-link {
      margin-top: auto;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #ef4444;
      font-weight: 600;
      padding: 12px 18px;
      border-left: 4px solid transparent;
      transition: background .2s ease, border-left-color .2s ease;
    }

    .logout-link:hover {
      background: #fef2f2;
      border-left-color: #ef4444;
    }

    .logout-link svg {
      width: 24px;
      height: 24px;
      fill: #ef4444;
    }

    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.28);
      opacity: 0;
      visibility: hidden;
      transition: opacity .2s ease, visibility .2s ease;
      z-index: 250;
    }

    .backdrop.open {
      opacity: 1;
      visibility: visible;
    }

    .main {
      padding: 84px 24px 32px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .main-heading {
      font-size: clamp(2rem, 3vw, 2.5rem);
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 1rem;
      letter-spacing: -0.5px;
      line-height: 1.2;
      border-bottom: 2px solid var(--border);
      padding-bottom: 0.5rem;
    }

    .main-section-title {
      margin: 26px 2px 14px;
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--primary);
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 1.5rem;
    }

    .card-head {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .ingredients-table {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 0 -18px;
      padding: 0 18px;
    }

    .ingredients-table table {
      width: 100%;
      min-width: 700px;
      border-collapse: collapse;
      font-size: 0.95em;
      background: var(--surface);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 1px 4px 0 rgba(38, 58, 74, 0.03);
    }

    .ingredients-table th,
    .ingredients-table td {
      font-size: 0.9em;
      padding: 0.75rem 0.5rem;
      word-break: break-word;
      border-bottom: 1px solid var(--border);
      text-align: center;
      vertical-align: middle;
    }

    .ingredients-table th:first-child,
    .ingredients-table td:first-child {
      text-align: left;
      padding-left: 0.75rem;
    }

    .ingredients-table th:last-child,
    .ingredients-table td:last-child {
      text-align: right;
      padding-right: 0.75rem;
    }

    .ingredients-table th {
      background: #f8f8f8;
      color: var(--text);
      font-weight: 700;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      white-space: nowrap;
    }

    .ingredients-table tbody tr:last-child td {
      border-bottom: none;
    }

    .ingredients-table tbody tr:hover {
      background: #fafafa;
    }

    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1.5px solid var(--border);
      margin-bottom: 0.25rem;
      background: #fafafa;
      color: var(--text);
      transition: border 0.15s;
    }

    input[type="number"]:focus,
    input[type="text"]:focus,
    select:focus {
      border: 1.5px solid var(--primary);
      outline: none;
    }

    label {
      font-weight: 600;
      color: var(--text);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: .72rem 1rem;
      border-radius: 10px;
      border: 1px solid #cfd8dc;
      background: #fff;
      color: #111;
      font-weight: 600;
      cursor: pointer;
      transition: transform .1s ease, box-shadow .2s ease, background .2s ease;
      width: 100%;
    }

    .btn:disabled {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn:hover {
      transform: translateY(-2px);
      background: #f0f0f0;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    .btn-primary {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
      box-shadow: 0 4px 12px rgba(35, 65, 35, 0.2);
    }

    .btn-primary:hover {
      background: var(--primary-600);
      border-color: var(--primary-600);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(35, 65, 35, 0.25);
    }

    #addRowBtn {
      border: 1.5px solid var(--primary);
      background: var(--primary);
      color: #fff;
      width: fit-content;
      padding: 0.35rem 0.75rem;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    #addRowBtn:hover {
      background: var(--primary-600);
      border-color: var(--primary-600);
    }

    .remove-btn {
      background: #dc3545;
      color: #fff;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.875rem;
      border: none;
      margin-left: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
    }

    .remove-btn:hover {
      background: #c82333;
    }

    #pricingResults .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    #pricingResults .results-grid>div {
      border-radius: 12px;
      box-shadow: 0 1px 4px 0 rgba(38, 58, 74, 0.04);
      border: 1.5px solid var(--border);
    }

    /* Button container responsiveness */
    .button-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
    }

    @media (min-width: 640px) {
      .button-container {
        flex-direction: row;
      }
      
      .button-container .btn {
        flex: 1;
      }
    }

    /* Ingredient buttons responsiveness */
    .ingredient-buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.2rem;
      flex-direction: column;
    }

    /* Product info grid responsiveness */
    @media (min-width: 768px) {
      .product-info-grid {
        grid-template-columns: 1fr 1fr !important;
      }
    }

    @media (min-width: 480px) {
      .ingredient-buttons {
        flex-direction: row;
      }
      
      .ingredient-buttons .btn {
        flex: 1;
        min-width: 140px;
      }
    }

    /* View All Product Prices Button Styling (Matched with Add Material's button) */
    .btn-view-prices {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 1.5rem;
      padding: 0.6rem 1.4rem;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: linear-gradient(135deg, #e6f7e7, #d1e8d2);
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(124, 197, 143, 0.25);
    }

    .btn-view-prices:hover {
      background: linear-gradient(135deg, #d1e8d2, #b2d7b5);
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 8px 20px rgba(124, 197, 143, 0.35);
    }

    .btn-view-prices i {
      color: var(--primary);
      transition: transform 0.2s ease;
    }

    /* Media query for tablets and smaller desktops */
    @media (max-width: 1024px) {
      .main {
        padding: 84px 20px 24px;
      }

      .ingredients-table {
        margin: 0 -18px;
      }
    }

    /* Media query for smaller tablets and large phones */
    @media (max-width: 768px) {
      .topbar {
        height: 60px;
      }

      .topbar-logo {
        height: 50px;
      }

      .main {
        padding: 76px 16px 24px;
      }

      .main-heading {
        font-size: 1.75rem;
        margin-bottom: 0.75rem;
      }

      .main-section-title {
        font-size: 1rem;
        margin: 20px 2px 12px;
      }

      .card {
        padding: 16px;
      }

      .ingredients-table {
        margin: 0 -16px;
        padding: 0 16px;
      }

      .ingredients-table table {
        min-width: 650px;
      }

      .ingredients-table th,
      .ingredients-table td {
        font-size: 0.85em;
        padding: 0.6rem 0.4rem;
      }

      input[type="number"],
      input[type="text"],
      select {
        padding: 0.45rem;
        font-size: 0.9rem;
      }

      #pricingResults .results-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      #pricingResults .results-grid>div {
        padding: 1rem !important;
      }
    }

    /* Media query for mobile phones */
    @media (max-width: 640px) {
      .topbar {
        height: 56px;
        padding: 0 12px;
      }

      .topbar-logo {
        height: 40px;
      }

      .drawer {
        width: 85vw;
        max-width: 300px;
      }

      .main {
        padding: 72px 12px 20px;
      }

      .main-heading {
        font-size: 1.5rem;
      }

      .main-section-title {
        font-size: 0.95rem;
        margin: 18px 0 10px;
      }

      .card {
        padding: 12px;
        gap: 10px;
        margin-bottom: 1rem;
      }

      .ingredients-table {
        margin: 0 -12px;
        padding: 0 12px;
      }

      .ingredients-table table {
        min-width: 580px;
        font-size: 0.85em;
      }

      .ingredients-table th,
      .ingredients-table td {
        padding: 0.5rem 0.3rem;
        font-size: 0.8em;
      }

      .ingredients-table th:first-child,
      .ingredients-table td:first-child {
        padding-left: 0.5rem;
      }

      .ingredients-table th:last-child,
      .ingredients-table td:last-child {
        padding-right: 0.5rem;
      }

      input[type="number"],
      input[type="text"],
      select {
        padding: 0.4rem;
        font-size: 0.875rem;
      }

      .btn {
        padding: 0.65rem 0.875rem;
        font-size: 0.9rem;
      }

      .remove-btn {
        width: 28px;
        height: 28px;
        font-size: 0.75rem;
      }

      .btn-view-prices {
        padding: 0.55rem 1.2rem;
        font-size: 0.9rem;
        width: 100%;
        justify-content: center;
      }

      #pricingResults .results-grid>div {
        padding: 0.875rem !important;
      }

      #pricingResults .results-grid>div>div:first-child {
        font-size: 0.85rem;
      }

      #pricingResults .results-grid>div>div:nth-child(2) {
        font-size: 1.1rem !important;
      }

      #pricingResults .results-grid>div>div:last-child {
        font-size: 0.8rem;
      }

      .message-box {
        padding: 0.875rem;
        font-size: 0.85rem;
      }
    }

    /* Extra small phones */
    @media (max-width: 380px) {
      .topbar {
        padding: 0 8px;
      }

      .main {
        padding: 72px 8px 16px;
      }

      .main-heading {
        font-size: 1.35rem;
      }

      .card {
        padding: 10px;
      }

      .ingredients-table {
        margin: 0 -10px;
        padding: 0 10px;
      }

      .ingredients-table table {
        min-width: 520px;
      }

      .btn {
        padding: 0.6rem 0.75rem;
        font-size: 0.85rem;
      }
    }

    .message-box {
      width: 100%;
      max-width: 600px;
      margin: 1.5rem auto 0;
      box-sizing: border-box;
      padding: 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .message-success {
      color: #286d42;
      background: #e6f7e7;
      border-left: 4px solid #286d42;
    }

    .message-error {
      color: #872a2a;
      background: #f9e6e7;
      border-left: 4px solid #872a2a;
    }

    .message-info {
      color: #1e40af;
      background: #eff6ff;
      border-left: 4px solid #1e40af;
    }

    .hidden {
      display: none;
    }

    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <!-- Top bar with hamburger + brand -->
  <header class="topbar" role="banner">
    <div class="left-logo-wrap">
      <img src="../assets/owner.jpg"
        onerror="this.onerror=null; this.src='https://placehold.co/40x40/e5e7eb/6b7280?text=O'" alt="User Logo">
      <button class="hamburger-btn" id="hamburgerBtn" aria-label="Open navigation" aria-controls="drawerNav"
        aria-expanded="false">
        <span class="hamburger" aria-hidden="true"></span>
      </button>
    </div>
    <img src="../assets/vasavi-logo.png"
      alt="Vasavi Ayurveda Logo" class="topbar-logo">
  </header>

  <!-- Drawer navigation -->
  <nav class="drawer" id="drawerNav" aria-hidden="true">
    <div style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:6px;">
      <div class="drawer-logo">
        <img src="../assets/vasavi-logo.png"
          alt="Vasavi Ayurveda Logo">
      </div>
      <a href="../index.html" class="drawer-link">Home</a>
      <a href="add-material.html" class="drawer-link">Add Material</a>
      <a href="product-price.html" class="drawer-link active">Add Product/Calculate</a>
      <a href="drug-entry.html" class="drawer-link" id="drugEntryLink">Add Drug</a>
      <a href="all-materials.html" class="drawer-link">Materials</a>
      <a href="all-product-prices.html" class="drawer-link">Products</a>
      <a href="all-drugs.html" class="drawer-link">All Drugs</a>
    </div>
    <a href="#" id="logoutLink" class="logout-link" style="border-top:1px solid #e5e7eb;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M16 9V17H12L12 19H16C17.1046 19 18 18.1046 18 17V9C18 7.89543 17.1046 7 16 7H12V9H16Z" fill="currentColor" />
        <path d="M9 14V12H2V14H9ZM9 12V14L12 11L9 8V10H2V12H9ZM9 12H11.5L9 9.5V12ZM9 12L11.5 14.5V12L9 9.5V12ZM16 7H12V9H16V17H12V19H16C17.1046 19 18 18.1046 18 17V9C18 7.89543 17.1046 7 16 7Z" fill="currentColor" />
      </svg>
      Logout
    </a>
  </nav>

  <!-- Backdrop -->
  <div class="backdrop" id="backdrop"></div>

  <!-- Main Content -->
  <main class="main">
    <h2 class="main-heading">Add Product/Calculate</h2>
    <div id="statusMessage" class="hidden message-box"></div>

    <!-- View All Prices Button (Redesigned) -->
    <a href="all-product-prices.html" class="btn-view-prices">
      <i class="fa-solid fa-eye"></i> View All Product Prices
    </a>

    <!-- Added input for Product Name -->
    <h2 class="main-section-title">Product Information</h2>
    <section class="card">
      <div class="product-info-grid" style="display:grid;grid-template-columns:1fr;gap:1.5rem;">
        <div>
          <label style="display:block;margin-bottom:0.5rem;font-weight:600;font-size:0.9rem;color:var(--text);">Product Name *</label>
          <input type="text" id="productNameInput" placeholder="Enter Product Name" style="width:100%;height:46px;">
        </div>
        <div>
          <label style="display:block;margin-bottom:0.5rem;font-weight:600;font-size:0.9rem;color:var(--text);">Description</label>
          <textarea id="productDescriptionInput" placeholder="Enter product description (optional)" rows="2" style="width:100%;padding:0.75rem;border:1px solid #ddd;border-radius:8px;font-family:'Inter',sans-serif;font-size:0.95rem;resize:none;height:46px;"></textarea>
        </div>
      </div>
    </section>

    <h2 class="main-section-title">Select Ingredients</h2>
    <section class="card">
      <div class="ingredients-table" style="margin-bottom:1.2rem;">
        <table>
          <thead>
            <tr>
              <th style="text-align:left;">Ingredient</th>
              <th>Quantity</th>
              <th>Unit</th>
              <th>Cost per unit</th>
              <th style="text-align:right;">Total Cost</th>
              <th style="text-align:right;">Action</th>
            </tr>
          </thead>
          <tbody id="materialRows">
            <!-- Dynamic rows will be inserted here -->
          </tbody>
        </table>
      </div>
      <button class="btn" id="addIngredientBtn" style="background:var(--primary);color:#fff;border-color:var(--primary);width:fit-content;padding:0.5rem 1rem;">+ Add Ingredient</button>
      <div style="margin-top:1.2rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.5rem;">
        <span style="font-weight:600;font-size:0.95rem;">Total Ingredient Cost:</span>
        <span id="totalMaterialCost" style="font-weight:700;font-size:1.05rem;color:var(--primary);">₹0.00</span>
      </div>
    </section>

    <h2 class="main-section-title">Bottle Information</h2>
    <section class="card">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
        <div>
          <label style="display:block;margin-bottom:0.5rem;font-weight:600;font-size:0.9rem;">Number of Bottles</label>
          <input type="number" id="numBottlesInput" min="1" step="1" value="1" placeholder="1" style="width:100%;">
        </div>
        <div>
          <label style="display:block;margin-bottom:0.5rem;font-weight:600;font-size:0.9rem;">Cost per Bottle (₹)</label>
          <input type="number" id="costPerBottleInput" min="0" step="0.01" value="0" placeholder="0" style="width:100%;">
        </div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.5rem;">
        <span style="font-weight:600;font-size:0.95rem;">Total Bottle Cost:</span>
        <span id="totalBottleCost" style="font-weight:700;font-size:1.05rem;color:var(--primary);">₹0.00</span>
      </div>
    </section>

    <section class="card">
      <div
        style="display:flex;justify-content:space-between;align-items:center;padding:0.9rem 1rem;background:#f8f8f8;border-radius:10px;margin-bottom:1.2rem;flex-wrap:wrap;gap:0.5rem;">
        <span style="font-weight:700;font-size:0.95rem;">Total Base Cost (Ingredients + Bottles):</span>
        <span id="totalCost" style="font-weight:700;font-size:1.1rem;color:var(--primary);">₹0.00</span>
      </div>
      <div class="button-container">
        <button class="btn" id="calculateBtn">
          <span id="calculateButtonText">Calculate</span>
        </button>
        <button class="btn btn-primary" id="calculateAndSaveBtn">
          <span id="saveButtonText">Calculate & Save</span>
          <div id="loadingIndicator" class="loading-spinner hidden"></div>
        </button>
      </div>
    </section>

    <h2 class="main-section-title">Pricing Calculations</h2>
    <section class="card" id="pricingResults" style="display:none;">
      <div class="results-grid">
        <div style="padding:1.2rem;background:#f0f0f0;text-align:center;border-radius:8px;">
          <div style="color:#666;margin-bottom:0.5rem;font-size:0.875rem;">Base Cost (₹)</div>
          <div style="font-size:1.5rem;font-weight:700;color:var(--primary);" id="resultBasePrice"></div>
          <div style="color:#666;font-size:0.8rem;margin-top:0.25rem;">Total ingredient + bottle cost</div>
        </div>
        <div style="padding:1.2rem;background:#f0f0f0;text-align:center;border-radius:8px;">
          <div style="color:#666;margin-bottom:0.5rem;font-size:0.875rem;">Margin 1 (113%)</div>
          <div style="font-size:1.5rem;font-weight:700;color:var(--primary);" id="resultMargin1"></div>
          <div style="color:#666;font-size:0.8rem;margin-top:0.25rem;">Base Cost × 113%</div>
        </div>
        <div style="padding:1.2rem;background:#f0f0f0;text-align:center;border-radius:8px;">
          <div style="color:#666;margin-bottom:0.5rem;font-size:0.875rem;">Margin 2 (12%)</div>
          <div style="font-size:1.5rem;font-weight:700;color:var(--primary);" id="resultMargin2"></div>
          <div style="color:#666;font-size:0.8rem;margin-top:0.25rem;">(Base Cost + Margin 1) × 12%</div>
        </div>
      </div>
      <div
        style="margin-top:1.5rem;text-align:center;padding:1.5rem 1.2rem;background:#234123;color:white;border-radius:12px;">
        <div style="margin-bottom:0.5rem;font-size:0.9rem;opacity:0.9;">Total Selling Price</div>
        <div style="font-size:2rem;font-weight:700;" id="resultTotalPrice"></div>
        <div style="font-size:1rem;margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid rgba(255,255,255,0.2);">
          Gross Selling Price per Bottle: <span id="resultPricePerBottle" style="font-weight:700;"></span>
        </div>
      </div>
    </section>
  </main>
  <script type="module" src="../js/product-price.js"></script>

  <!-- Script to check user role and hide Add Drug link -->
  <script type="module">
    // Topbar logout button for desktop
    document.addEventListener('DOMContentLoaded', () => {
      const logoutTopbarBtn = document.getElementById('logoutTopbarBtn');
      if (logoutTopbarBtn) {
        logoutTopbarBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          try {
            await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js').then(({ signOut }) => signOut(auth));
            window.location.href = '../login.html';
          } catch (error) {
            console.error("Error signing out: ", error);
          }
        });
      }
    });
    import { initializeFirebase, auth, db, getDoc, doc } from "../js/firebase-config.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Check the user's role and conditionally show/hide the 'Add Drug' link
    async function checkUserRole(uid) {
      try {
        if (!db) {
          console.error("Firestore not initialized.");
          return;
        }
        const userDocRef = doc(db, "userRoles", uid);
        const userRoleSnap = await getDoc(userDocRef);

        const drugEntryLink = document.getElementById('drugEntryLink');

        if (userRoleSnap.exists()) {
          const role = userRoleSnap.data().role;
          if (role !== 'admin') {
            if (drugEntryLink) drugEntryLink.style.display = 'none';
          } else {
            if (drugEntryLink) drugEntryLink.style.display = 'block';
          }
        } else {
          // Default to non-admin if no role is found
          if (drugEntryLink) drugEntryLink.style.display = 'none';
        }
      } catch (error) {
        console.error("Error fetching user role:", error);
        // Hide link in case of an error to be safe
        const drugEntryLink = document.getElementById('drugEntryLink');
        if (drugEntryLink) drugEntryLink.style.display = 'none';
      }
    }

    async function setupAuthCheck() {
      await initializeFirebase();
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          console.log("No user found, redirecting to login page.");
          window.location.href = '../login.html';
        } else {
          console.log("User found, checking role.");
          checkUserRole(user.uid);
        }
      });
    }
    window.onload = setupAuthCheck;
  </script>
  <script>
    // ...existing code...
  </script>
</body>

</html>